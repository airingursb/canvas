# Ch16 çŸ©é˜µå˜æ¢

## å˜æ¢çŸ©é˜µ

ä¹‹å‰ä¸‰èŠ‚æ‰€è¯´çš„åæ ‡å˜æ¢çš„ä¸‰ç§æ–¹å¼â€”â€”å¹³ç§»`translate()`ï¼Œç¼©æ”¾`scale()`ï¼Œä»¥åŠæ—‹è½¬`rotate()`éƒ½å¯ä»¥é€šè¿‡`transform()`åšåˆ°ã€‚

åœ¨ä»‹ç»çŸ©é˜µå˜æ¢`transform()`å‰ï¼Œæˆ‘ä»¬æ¥è¯´ä¸€è¯´ä»€ä¹ˆæ˜¯å˜æ¢çŸ©é˜µã€‚

![å˜æ¢çŸ©é˜µ](http://airing.ursb.me/edu16-1.png-normal.jpg)

ä»¥ä¸Šæ˜¯Canvasä¸­`transform()`æ–¹æ³•æ‰€å¯¹åº”çš„å˜æ¢çŸ©é˜µã€‚è€Œæ­¤æ–¹æ³•æ­£æ˜¯ä¼ å…¥å›¾ä¸­æ‰€ç¤ºçš„å…­ä¸ªå‚æ•°ï¼Œå…·ä½“ä¸º`context.transform(a,b,c,d,e,f)`ã€‚

å„å‚æ•°æ„ä¹‰å¯¹åº”å¦‚ä¸‹è¡¨ï¼š

|å‚æ•°|æ„ä¹‰|
|:--:|:--|
|a|æ°´å¹³ç¼©æ”¾(1)|
|b|æ°´å¹³å€¾æ–œ(0)|
|c|å‚ç›´å€¾æ–œ(0)|
|d|å‚ç›´ç¼©æ”¾(1)|
|e|æ°´å¹³ä½ç§»(0)|
|f|å‚ç›´ä½ç§»(0)|

å½“æˆ‘ä»¬æŠŠå¯¹åº”çš„0æˆ–1ä»£å…¥è¿›çŸ©é˜µï¼Œå¯ä»¥å‘ç°è¿™æ˜¯ä¸€ä¸ªå•ä½çŸ©é˜µï¼ˆæ°´å¹³å’Œå‚ç›´ç¼©æ”¾é»˜è®¤å€¼æ˜¯1ï¼Œä»£è¡¨ç¼©æ”¾1å€ï¼Œå³ä¸ç¼©æ”¾ï¼‰ã€‚è¯¥æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªæ–°çš„å˜åŒ–çŸ©é˜µä¸å½“å‰å˜æ¢çŸ©é˜µè¿›è¡Œä¹˜æ³•è¿ç®—ï¼Œç„¶åå¾—åˆ°å„ç§å˜åŒ–çš„æ•ˆæœã€‚

è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ï¼Œ**å½“æˆ‘ä»¬æƒ³å¯¹ä¸€ä¸ªå›¾å½¢è¿›è¡Œå˜æ¢çš„æ—¶å€™ï¼Œåªè¦å¯¹å˜æ¢çŸ©é˜µç›¸åº”çš„å‚æ•°è¿›è¡Œæ“ä½œï¼Œæ“ä½œä¹‹åï¼Œå¯¹å›¾å½¢çš„å„ä¸ªå®šç‚¹çš„åæ ‡åˆ†åˆ«ä¹˜ä»¥è¿™ä¸ªçŸ©é˜µï¼Œå°±èƒ½å¾—åˆ°æ–°çš„å®šç‚¹çš„åæ ‡ã€‚**

è€ŒCanvasç»˜å›¾ä¸­ï¼Œå°±ç»™å’±ä»¬æä¾›äº†ä¸€ä¸ªå‡½æ•°æ¥æ”¹å˜è¿™ä¸ªå˜æ¢çŸ©é˜µï¼Œé‚£å°±æ˜¯`transform()`ã€‚

## çŸ©é˜µå˜æ¢`transform()`

> æ³¨ï¼šä»¥ä¸‹ä¸‰ä¸ªå˜æ¢çš„è½¬æ¢ç»“è®ºè½¬è‡ª[å¼ é›¯çš„åšå®¢](http://blog.sina.com.cn/s/blog_5f38c0560100uzrj.html)ï¼Œç«¥é‹ä»¬å¯ä»¥æˆ³è¿›å»çœ‹çœ‹è¯¦æƒ…ã€‚

### å¹³ç§»å˜æ¢

![å¹³ç§»å˜æ¢](http://airing.ursb.me/edu16-2.jpg-normal.jpg)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š
`xâ€™ = x + dx`ï¼Œ
`yâ€™ = y + dy`ã€‚

ä¹Ÿå³æ˜¯è¯´å¯ä»¥ä½¿ç”¨
`context.transform (1,0,0,1,dx,dy)`ä»£æ›¿`context.translate(dx,dy)`ã€‚
ä¹Ÿå¯ä»¥ä½¿ç”¨
`context.transform(0,1,1,0,dx,dy)`ä»£æ›¿ã€‚

### ç¼©æ”¾å˜æ¢

åŒç†å¯ä»¥ä½¿ç”¨
`context.transform(sx,0,0,sy,0,0)`ä»£æ›¿`context.scale(sx, sy)`;

ä¹Ÿå¯ä»¥ä½¿ç”¨`context.transform(0,sy,sx,0,0,0)`;

### æ—‹è½¬å˜æ¢

![æ—‹è½¬å˜æ¢](http://airing.ursb.me/edu16-3.jpeg-normal.jpg)
å¦‚ä¸Šå›¾å›¾æ‰€ç¤ºï¼š

Bç‚¹æ˜¯é€šè¿‡Aç‚¹é€†æ—¶é’ˆæ—‹è½¬Î¸å¾—åˆ°ï¼Œ
`x = r * cosa`ï¼Œ
`y = r * sina`

å³
`xâ€™=r*cos(a+Î¸)=x*cosÎ¸-y*sinÎ¸`ï¼Œ
`yâ€™=r*sin(a+Î¸)=x*sinÎ¸+y*cosÎ¸`

ä¹Ÿå³æ˜¯
![å˜æ¢çŸ©é˜µ](http://airing.ursb.me/edu16-4.jpg)

ç»¼ä¸Šï¼š
`context.transform(Math.cos(Î¸*Math.PI/180)ï¼ŒMath.sin(Î¸*Math.PI/180),
-Math.sin(Î¸*Math.PI/180),Math.cos(Î¸*Math.PI/180)ï¼Œ0ï¼Œ0ï¼‰`å¯ä»¥æ›¿ä»£`context.rotate(Î¸)`ã€‚

ä¹Ÿå¯ä»¥ä½¿ç”¨
`context.transform(-Math.sin(Î¸*Math.PI/180),Math.cos(Î¸*Math.PI/180)ï¼Œ
Math.cos(Î¸*Math.PI/180)ï¼ŒMath.sin(Î¸*Math.PI/180)ï¼Œ0ï¼Œ0ï¼‰`æ›¿ä»£ã€‚

***
ä»¥ä¸Šç»“è®ºå¼•è‡ª[å¼ é›¯çš„åšå®¢](http://blog.sina.com.cn/s/blog_5f38c0560100uzrj.html)ï¼Œå¾ˆå¥½çš„è¯´æ˜äº†çŸ©é˜µå˜æ¢çš„è¿‡ç¨‹ï¼Œä½†æ˜¯ç»“è®ºè¿‡äºå¤æ‚ï¼Œå»ºè®®ä½¿ç”¨`transform()`çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨å¦‚ä¸‹å‡ ä¸ªæƒ…å†µä¸‹ä½¿ç”¨ï¼š

1. ä½¿ç”¨`context.transform (1,0,0,1,dx,dy)`ä»£æ›¿`context.translate(dx,dy)`
2. ä½¿ç”¨`context.transform(sx,0,0,sy,0,0)`ä»£æ›¿`context.scale(sx, sy)`
3. ä½¿ç”¨`context.transform(0,b,c,0,0,0)`æ¥å®ç°å€¾æ–œæ•ˆæœ(æœ€å®ç”¨)ã€‚

ä¸ç”¨å†ä½¿ç”¨å®ƒå»å®ç°æ—‹è½¬äº†ï¼Œå¦å¤–ä¹Ÿæ²¡æœ‰ä¹Ÿä¸ç”¨å…¨è®°è¿™äº›ç»“è®ºï¼Œç›´æ¥è®°ä¸‹abcdefå…­ä¸ªå‚æ•°çš„æ„ä¹‰ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚

ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªä»£ç ï¼Œç†Ÿæ‚‰ä¸€ä¸‹ï¼š
```HTML
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>çŸ©é˜µå˜æ¢</title>
    <style>
        body { background: url("./images/bg3.jpg") repeat; }
        #canvas { border: 1px solid #aaaaaa; display: block; margin: 50px auto; }
    </style>
</head>
<body>
<div id="canvas-warp">
    <canvas id="canvas">
        ä½ çš„æµè§ˆå™¨å±…ç„¶ä¸æ”¯æŒCanvasï¼Ÿï¼èµ¶å¿«æ¢ä¸€ä¸ªå§ï¼ï¼
    </canvas>
</div>

<script>
    window.onload = function(){
        var canvas = document.getElementById("canvas");
        canvas.width = 800;
        canvas.height = 600;
        var context = canvas.getContext("2d");
        context.fillStyle = "#FFF";
        context.fillRect(0,0,800,600);

        context.fillStyle = "yellow";
        context.strokeStyle = "#00AAAA";
        context.lineWidth = 5;

        context.save();
        //å¹³ç§»è‡³(300,200)
        context.transform(1,0,0,1,300,200);
        //æ°´å¹³æ–¹å‘æ”¾å¤§2å€ï¼Œå‚ç›´æ–¹å‘æ”¾å¤§1.5å€
        context.transform(2,0,0,1.5,0,0);
        //æ°´å¹³æ–¹å‘å‘å³å€¾æ–œå®½åº¦10%çš„è·ç¦»ï¼Œå‚ç›´æ–¹å‘å‘ä¸Šå€¾æ–œé«˜åº¦10%çš„è·ç¦»
        context.transform(1,-0.1,0.1,1,0,0);
        context.fillRect(0,0,200,200);
        context.strokeRect(0,0,200,200);
        context.restore();
    };
</script>
</body>
</html>
```

[æ¼”ç¤º 16-1](http://airingursb.github.io/canvas/Canvas/16/16-1.html)

è¿è¡Œç»“æœï¼š

![transform](http://airing.ursb.me/edu16-5.png-html.jpg)

## `setTransform()`æ–¹æ³•

`transform() `æ–¹æ³•çš„è¡Œä¸ºç›¸å¯¹äºç”± `rotate()`,`scale()`, `translate()`, or `transform()` å®Œæˆçš„å…¶ä»–å˜æ¢ã€‚ä¾‹å¦‚ï¼šå¦‚æœæˆ‘ä»¬å·²ç»å°†ç»˜å›¾è®¾ç½®ä¸ºæ”¾åˆ°ä¸¤å€ï¼Œåˆ™ `transform()` æ–¹æ³•ä¼šæŠŠç»˜å›¾æ”¾å¤§ä¸¤å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç»˜å›¾æœ€ç»ˆå°†æ”¾å¤§å››å€ã€‚è¿™ä¸€ç‚¹å’Œä¹‹å‰çš„å˜æ¢æ˜¯ä¸€æ ·çš„ã€‚

ä½†æ˜¯`setTransform()`ä¸ä¼šç›¸å¯¹äºå…¶ä»–å˜æ¢æ¥å‘ç”Ÿè¡Œä¸ºã€‚å®ƒçš„å‚æ•°ä¹Ÿæ˜¯å…­ä¸ªï¼Œ`context.setTransform(a,b,c,d,e,f)`ï¼Œä¸`transform()`ä¸€æ ·ã€‚

è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š
ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢ï¼Œé€šè¿‡ `setTransform()` é‡ç½®å¹¶åˆ›å»ºæ–°çš„å˜æ¢çŸ©é˜µï¼Œå†æ¬¡ç»˜åˆ¶çŸ©å½¢ï¼Œé‡ç½®å¹¶åˆ›å»ºæ–°çš„å˜æ¢çŸ©é˜µï¼Œç„¶åå†æ¬¡ç»˜åˆ¶çŸ©å½¢ã€‚

```HTML
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>çŸ©é˜µå˜æ¢</title>
    <style>
        body { background: url("./images/bg3.jpg") repeat; }
        #canvas { border: 1px solid #aaaaaa; display: block; margin: 50px auto; }
    </style>
</head>
<body>
<div id="canvas-warp">
    <canvas id="canvas">
        ä½ çš„æµè§ˆå™¨å±…ç„¶ä¸æ”¯æŒCanvasï¼Ÿï¼èµ¶å¿«æ¢ä¸€ä¸ªå§ï¼ï¼
    </canvas>
</div>

<script>
    window.onload = function(){
        var canvas = document.getElementById("canvas");
        canvas.width = 800;
        canvas.height = 600;
        var context = canvas.getContext("2d");
        context.fillStyle = "#FFF";
        context.fillRect(0,0,800,600);

        context.fillStyle="yellow";
        context.fillRect(200,100,250,100)

        context.setTransform(1,0.5,-0.5,1,30,10);
        context.fillStyle="red";
        context.fillRect(200,100,250,100);

        context.setTransform(1,0.5,-0.5,1,30,10);
        context.fillStyle="blue";
        context.fillRect(200,100,250,100);
    };
</script>
</body>
</html>
```

[æ¼”ç¤º 16-2](http://airingursb.github.io/canvas/Canvas/16/16-2.html)

è¿è¡Œç»“æœï¼š

![setTransform](http://airing.ursb.me/edu16-6.png-html.jpg)

è§£é‡Šä¸€ä¸‹è¿‡ç¨‹ï¼šæ¯å½“æˆ‘ä»¬è°ƒç”¨ `setTransform()` æ—¶ï¼Œå®ƒéƒ½ä¼šé‡ç½®å‰ä¸€ä¸ªå˜æ¢çŸ©é˜µç„¶åæ„å»ºæ–°çš„çŸ©é˜µï¼Œå› æ­¤åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸ä¼šæ˜¾ç¤ºçº¢è‰²çŸ©å½¢ï¼Œå› ä¸ºå®ƒåœ¨è“è‰²çŸ©å½¢ä¸‹é¢ã€‚


è¿™ä¸€èŠ‚çš„å†…å®¹æœ‰äº›éš¾å’Œå¤šï¼Œä½†æ˜¯é™¤äº†å€¾æ–œå…¶ä»–å¹¶ä¸å®ç”¨ï¼Œæ‰€ä»¥ç«¥é‹ä»¬å°½é‡äº†è§£ä¸€ä¸‹å°±å¥½ï¼Œèƒ½å¤ŸæŒæ¡å°±æ›´å¥½å•¦ï¼è‡³æ­¤ï¼Œæ‰€æœ‰çš„å›¾å½¢å˜æ¢æˆ‘ä»¬å·²ç»ä¸Šå®Œäº†ï¼ŒåŸºæœ¬çš„ä¸‰å¤§å˜åŒ–â€”â€”*å¹³ç§»å˜æ¢ã€æ—‹è½¬å˜æ¢ã€ç¼©æ”¾å˜æ¢*ï¼Œä»¥åŠä¸‡èƒ½çš„*çŸ©é˜µå˜æ¢*ã€‚å¤§å®¶éƒ½ä»¥åŠå®Œå…¨æŒæ¡äº†å—ï¼Ÿå¦‚æœä¸ç†Ÿç»ƒï¼Œè¦å›å¤´å¤šçœ‹çœ‹ï¼Œå¹¶ä¸”å¤šåŠ ç»ƒä¹ ã€‚ç¨ä½œä¼‘æ¯ï¼Œä¸‹ä¸€èŠ‚å¼€å§‹ï¼Œå°±æ˜¯æ–°çš„èˆªç¨‹ï¼æˆ‘ä»¬ç»§ç»­å‰è¿›ï¼ğŸ˜‹


