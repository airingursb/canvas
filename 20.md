# Ch20 è£å‰ªå’Œç»˜åˆ¶å›¾åƒ

## è£å‰ªåŒºåŸŸ`clip()`

ä½¿ç”¨Canvasç»˜åˆ¶å›¾åƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæƒ³è¦åªä¿ç•™å›¾åƒçš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨canvas APIå†å¸¦çš„å›¾åƒè£å‰ªåŠŸèƒ½æ¥å®ç°è¿™ä¸€æƒ³æ³•ã€‚

Canvas APIçš„å›¾åƒè£å‰ªåŠŸèƒ½æ˜¯æŒ‡ï¼Œåœ¨ç”»å¸ƒå†…ä½¿ç”¨è·¯å¾„ï¼Œåªç»˜åˆ¶è¯¥è·¯å¾„å†…æ‰€åŒ…å«åŒºåŸŸçš„å›¾åƒï¼Œä¸ç»˜åˆ¶è·¯å¾„å¤–çš„å›¾åƒã€‚è¿™æœ‰ç‚¹åƒFlashä¸­çš„å›¾å±‚é®ç½©ã€‚

ä½¿ç”¨å›¾å½¢ä¸Šä¸‹æ–‡çš„ä¸å¸¦å‚æ•°çš„`clip()`æ–¹æ³•æ¥å®ç°Canvasçš„å›¾åƒè£å‰ªåŠŸèƒ½ã€‚è¯¥æ–¹æ³•ä½¿ç”¨è·¯å¾„æ¥å¯¹Canvasç”»å¸ƒè®¾ç½®ä¸€ä¸ªè£å‰ªåŒºåŸŸã€‚å› æ­¤ï¼Œå¿…é¡»å…ˆåˆ›å»ºå¥½è·¯å¾„ã€‚åˆ›å»ºå®Œæ•´åï¼Œè°ƒç”¨`clip()`æ–¹æ³•æ¥è®¾ç½®è£å‰ªåŒºåŸŸã€‚

éœ€è¦æ³¨æ„çš„æ˜¯**è£å‰ªæ˜¯å¯¹ç”»å¸ƒè¿›è¡Œçš„ï¼Œè£åˆ‡åçš„ç”»å¸ƒä¸èƒ½æ¢å¤åˆ°åŸæ¥çš„å¤§å°**ï¼Œä¹Ÿå°±æ˜¯è¯´ç”»å¸ƒæ˜¯è¶Šåˆ‡è¶Šå°çš„ï¼Œè¦æƒ³ä¿è¯æœ€åä»ç„¶èƒ½åœ¨canvasæœ€åˆå®šä¹‰çš„å¤§å°ä¸‹ç»˜å›¾éœ€è¦æ³¨æ„`save()`å’Œ`restore()`ã€‚ç”»å¸ƒæ˜¯å…ˆè£åˆ‡å®Œäº†å†è¿›è¡Œç»˜å›¾ã€‚å¹¶ä¸ä¸€å®šéè¦æ˜¯å›¾ç‰‡ï¼Œè·¯å¾„ä¹Ÿå¯ä»¥æ”¾è¿›å»~

å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªç®€å•çš„Demoã€‚

```HTML
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>è£å‰ªåŒºåŸŸ</title>
    <style>
        body { background: url("./images/bg3.jpg") repeat; }
        #canvas { border: 1px solid #aaaaaa; display: block; margin: 50px auto; }
    </style>
</head>
<body>
<div id="canvas-warp">
    <canvas id="canvas">
        ä½ çš„æµè§ˆå™¨å±…ç„¶ä¸æ”¯æŒCanvasï¼Ÿï¼èµ¶å¿«æ¢ä¸€ä¸ªå§ï¼ï¼
    </canvas>
</div>

<script>
    window.onload = function(){
        var canvas = document.getElementById("canvas");
        canvas.width = 800;
        canvas.height = 600;
        var context = canvas.getContext("2d");
        context.fillStyle = "#FFF";
        context.fillRect(0,0,800,600);

        //åœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€ä¸ªå¤§æ–¹å—
        context.fillStyle = "black";
        context.fillRect(10,10,200,200);
        context.save();
        context.beginPath();

        //è£å‰ªç”»å¸ƒä»(0ï¼Œ0)ç‚¹è‡³(50ï¼Œ50)çš„æ­£æ–¹å½¢
        context.rect(0,0,50,50);
        context.clip();

        //çº¢è‰²åœ†
        context.beginPath();
        context.strokeStyle = "red";
        context.lineWidth = 5;
        context.arc(100,100,100,0,Math.PI * 2,false);
        //æ•´åœ†
        context.stroke();
        context.closePath();

        context.restore();

        //å†æ¬¡è£åˆ‡æ•´ä¸ªç”»å¸ƒ
        context.beginPath();
        context.rect(0,0,500,500);
        context.clip();

        //ç»˜åˆ¶ä¸€ä¸ªæ²¡æœ‰è£åˆ‡çš„è“çº¿
        context.beginPath();
        context.strokeStyle = "blue";
        context.lineWidth = 5;
        context.arc(100,100,50,0,Math.PI * 2,false);
        //æ•´åœ†
        context.stroke();
        context.closePath();
    };
</script>
</body>
</html>
```

[æ¼”ç¤º 20-1](http://airingursb.github.io/canvas/Canvas/20/20-1.html)

è¿è¡Œç»“æœï¼š

![è£å‰ªåŒºåŸŸ](http://airing.ursb.me/edu20-2.png-html.jpg)

è‡ªå·±åˆ†æå§ï¼Œèƒ½å¤Ÿç†è§£è¿™æ®µç¨‹åºï¼Œå°±å®Œå…¨æŒæ¡äº†`clip()`æ–¹æ³•çš„ä½¿ç”¨äº†ã€‚

## ç»˜åˆ¶å›¾åƒ`drawImage()`

`drawImage()`æ˜¯ä¸€ä¸ªå¾ˆå…³é”®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å¼•å…¥å›¾åƒã€ç”»å¸ƒã€è§†é¢‘ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç¼©æ”¾æˆ–è£å‰ªã€‚

ä¸€å…±æœ‰ä¸‰ç§è¡¨ç°å½¢å¼ï¼š

1. ä¸‰å‚æ•°ï¼š`context.drawImage(img,x,y)`
2. äº”å‚æ•°ï¼š`context.drawImage(img,x,y,width,height)`
3. ä¹å‚æ•°ï¼š`context.drawImage(img,sx,sy,swidth,sheight,x,y,width,height)`

ä¸‰å‚æ•°çš„æ˜¯æ ‡å‡†å½¢å¼ï¼Œå¯ç”¨äºåŠ è½½å›¾åƒã€ç”»å¸ƒæˆ–è§†é¢‘ï¼›äº”å‚æ•°çš„é™¤äº†å¯ä»¥åŠ è½½å›¾åƒè¿˜å¯ä»¥å¯¹å›¾åƒè¿›è¡ŒæŒ‡å®šå®½é«˜çš„ç¼©æ”¾ï¼›ä¹å‚æ•°çš„é™¤äº†ç¼©æ”¾ï¼Œè¿˜å¯ä»¥è£å‰ªã€‚å„å‚æ•°æ„ä¹‰è§ä¸‹è¡¨ã€‚

|å‚æ•°|æè¿°|
|:--:|:--:|
|img|è§„å®šè¦ä½¿ç”¨çš„å›¾åƒã€ç”»å¸ƒæˆ–è§†é¢‘ã€‚|
|sx|å¯é€‰ã€‚å¼€å§‹å‰ªåˆ‡çš„ x åæ ‡ä½ç½®ã€‚|
|sy|å¯é€‰ã€‚å¼€å§‹å‰ªåˆ‡çš„ y åæ ‡ä½ç½®ã€‚|
|swidth|å¯é€‰ã€‚è¢«å‰ªåˆ‡å›¾åƒçš„å®½åº¦ã€‚|
|sheight|å¯é€‰ã€‚è¢«å‰ªåˆ‡å›¾åƒçš„é«˜åº¦ã€‚|
|x|åœ¨ç”»å¸ƒä¸Šæ”¾ç½®å›¾åƒçš„ x åæ ‡ä½ç½®ã€‚|
|y|åœ¨ç”»å¸ƒä¸Šæ”¾ç½®å›¾åƒçš„ y åæ ‡ä½ç½®ã€‚|
|width|å¯é€‰ã€‚è¦ä½¿ç”¨çš„å›¾åƒçš„å®½åº¦ã€‚ï¼ˆä¼¸å±•æˆ–ç¼©å°å›¾åƒï¼‰|
|height|å¯é€‰ã€‚è¦ä½¿ç”¨çš„å›¾åƒçš„é«˜åº¦ã€‚ï¼ˆä¼¸å±•æˆ–ç¼©å°å›¾åƒï¼‰|

ä¸‹é¢ï¼Œæˆ‘ä»¬åŠ è½½ä¸€ä¸ªå›¾ç‰‡è¯•è¯•ã€‚

```HTML
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>drawImage()</title>
    <style>
        body { background: url("./images/bg3.jpg") repeat; }
        #canvas { border: 1px solid #aaaaaa; display: block; margin: 50px auto; }
    </style>
</head>
<body>
<div id="canvas-warp">
    <canvas id="canvas">
        ä½ çš„æµè§ˆå™¨å±…ç„¶ä¸æ”¯æŒCanvasï¼Ÿï¼èµ¶å¿«æ¢ä¸€ä¸ªå§ï¼ï¼
    </canvas>
</div>

<script>
    window.onload = function(){
        var canvas = document.getElementById("canvas");
        canvas.width = 800;
        canvas.height = 600;
        var context = canvas.getContext("2d");
        context.fillStyle = "#FFF";
        context.fillRect(0,0,800,600);

        var img = new Image();
        img.src = "./images/20-1.jpg";
        img.onload = function(){
            context.drawImage(img,200,50);
        }
    };
</script>
</body>
</html>
```

[æ¼”ç¤º 20-2](http://airingursb.github.io/canvas/Canvas/20/20-2.html)

è¿è¡Œç»“æœï¼š

![drawImage()](http://airing.ursb.me/edu20-3.png-html.jpg)

## åˆ›å»ºç›¸æ¡†

è¿™é‡Œï¼Œæˆ‘ä»¬ç»“åˆ`clip()`å’Œ`drawImage()`ä»¥åŠä¹‹å‰å­¦çš„ä¸‰æ¬¡è´å¡å°”æ›²çº¿`bezierCurveTo()`ï¼Œæ¥ä¸ºä¸Šé¢ä¸€ä¸ªæ¡ˆä¾‹ï¼ŒåŠ ä¸Šä¸€ä¸ªå¿ƒå½¢çš„ç›¸æ¡†~

```HTML
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ç»˜åˆ¶å¿ƒå½¢ç›¸æ¡†</title>
    <style>
        body { background: url("./images/bg3.jpg") repeat; }
        #canvas { border: 1px solid #aaaaaa; display: block; margin: 50px auto; }
    </style>
</head>
<body>
<div id="canvas-warp">
    <canvas id="canvas">
        ä½ çš„æµè§ˆå™¨å±…ç„¶ä¸æ”¯æŒCanvasï¼Ÿï¼èµ¶å¿«æ¢ä¸€ä¸ªå§ï¼ï¼
    </canvas>
</div>

<script>
    window.onload = function(){
        var canvas = document.getElementById("canvas");
        canvas.width = 800;
        canvas.height = 600;
        var context = canvas.getContext("2d");
        context.fillStyle = "#FFF";
        context.fillRect(0,0,800,600);

        context.beginPath();
        context.moveTo(400,260);
        context.bezierCurveTo(450,220,450,300,400,315);
        context.bezierCurveTo(350,300,350,220,400,260);
        context.clip();
        context.closePath();

        var img = new Image();
        img.src = "./images/20-1.jpg";
        img.onload = function(){
            context.drawImage(img,348,240,100,100);
        }
    };
</script>
</body>
</html>
```

[æ¼”ç¤º 20-3](http://airingursb.github.io/canvas/Canvas/20/20-3.html)

è¿è¡Œç»“æœæˆªå›¾ï¼š

![ç»˜åˆ¶å¿ƒå½¢ç›¸æ¡†](http://airing.ursb.me/edu20-4.png)

æ˜¯ä¸æ˜¯ç¾ç¾çš„ï¼Ÿå¥½å•¦ï¼Œè‡³æ­¤æœ€å…³é”®çš„é®ç½©å’Œå›¾åƒè£å‰ªå·²ç»è¯´å®Œäº†ï¼Œå…¶å®åœ¨java.awtä¸­ï¼Œ`drawImage()`ä¹Ÿæ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„æ–¹æ³•ã€‚æœ‰äººè¯´åˆ¶ä½œJavaæ¸¸æˆç•Œé¢ï¼Œåªè¦ä¼šç”¨`drawImage()`å°±å¯ä»¥ä¸€æ‹›æ‰“éå¤©ä¸‹~åœ¨Canvasé‡Œä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ç¾å·¥æä¾›çš„ç´ æåŸºæœ¬éƒ½æ˜¯å›¾ç‰‡ï¼Œè¿™ä¸ªæ—¶å€™`drawImage()`å¯¹å›¾ç‰‡çš„å¤„ç†å°±å¾ˆé‡è¦äº†ã€‚æ—¢æ˜¯åŸºæœ¬åŠŸï¼Œä¹Ÿæ˜¯å¯¹å›¾ç‰‡æœ€é‡è¦çš„å¤„ç†æ–¹æ³•ã€‚

è¿™ä¸€èŠ‚å°±è·Ÿå¤§å®¶å¹è¿™ä¹ˆå¤šäº†~è®©æˆ‘ä»¬ç»§ç»­å‰è¿›ï¼ğŸ˜‹
